# Step8. 네트워크의 전체 흐름
 - OSI 모델의 전체 흐름
 - 캡슐화와 역캡슐화

### 요약
- 응용 계층(+세션 계층, 표현 계층): 애플리케이션에서 사용하는 데이터를 송수신
- 전송 계층: 목적지에 데이터를 정확하게 전달
- 네트워크 계층: 다른 네트워크에 있는 목적지에 데이터를 전달
- 데이터 링크 계층: 랜에서 데이터를 송수신
- 물리 계층: 데이터를 전기 신호로 변환

### Example
- 사용자: 웹 브라우저에서 http://www.google.com 접속

- 응용 계층: GET /index.html HTTP/1.1 (html 데이터 요청)
- 전송 계층: 출발지 포트번호(well-known 포트가 아닌 것 중에 무작위 선택, 예:3500), 목적지 포트번호(80, HTTP) 등을 포함한 TCP 헤더를 붙인 세그먼트 전송
- 네트워크 계층: 출발지 IP주소(192.168.1.10)와 목적지 IP주소(192.168.10.5) 등의 IP헤더를 붙인 IP 패킷 전송
- 데이터 링크 계층: 출발지 MAC, 목적지 MAC 주소, 라우터의 MAC 주소 등이 담긴 이더넷 헤더와 트레일러를 붙인 이더넷 프레임 전송
- 물리 계층: 스위치 장비를 통해 전기신호로 변환되어 전송

### 스위치와 라우터에서의 데이터 처리
- 컴퓨터 -> 스위치A -> 라우터A -> 라우터B -> 스위치B -> 웹서버
- 스위치A
	1. 데이터 링크 계층: 전기 신호로 변환하여 라우터A로 전송
	2. 물리 계층: 전기 신호 전송
- 라우터A
	1. 물리 계층: 스위치A로부터 전기 신호 도착
	2. 데이터 링크 계층: 목적지 MAC과 자신의 MAC이 같으면 이더넷 헤더를 분리하는 역캡슐화 수행
	3. 네트워크 계층: 라우팅 테이블에서 목적지 IP 주소(LAN 주소)를 찾아 설정 + 출발지 IP를 라우터A의 외부 IP 주소(WAN)로 변경 
	4. 데이터 링크 계층: 라우터B에 전송하도록 이더넷 헤더와 트레일러를 붙이는 캡슐화 수행
	5. 물리 계층: 라우터B까지 전기 신호로 데이터 전달
- 라우터B
	1. 물리 계층: 전기 신호 도착
	2. 데이터 링크 계층: 목적지 MAC 주소와 본인의 MAC 주소를 비교하여 맞으면 역캡슐화 수행
	3. 네트워크 계층: 자신의 라우팅 테이블과 목적지 IP 주소 비교 + 출발지 IP를 라우터B 의 내부 IP 주소로 변경
	4. 데이터 링크 계층: 스위치B에 전달되도록 이더넷 헤더, 트레일러 붙임
	5. 물리 계층: 스위치B까지 전기 신호로 데이터 전달
- 스위치B
	1. 물리 계층: 전기 신호 도착
	2. 데이터 링크 계층: 웹서버로 전기 신호 전달