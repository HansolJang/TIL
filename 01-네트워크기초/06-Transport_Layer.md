# Step6. 전송 계층
  - 전송 계층의 역할
  - 연결형 통신 과 비연결형 통신
  - TCP
  - UDP


### Transport Layer
신뢰할 수 있는 데이터를 어떻게 보장할 것인가
- 데이터의 신뢰성/정확성(연결형) vs 효율성(비연결형) -> **TCP**
- 목적지 애플리케이션 식별 기능 -> **Port number**

### TCP
- 연결형 통신 프로토콜
- 세그먼트: [TCP 헤더][데이터]
- TCP 헤더 
	* 출발지 포트 번호(16비트) + 목적지 포트 번호(16비트)
	* 일련번호(32비트) 
	* 확인 응답 번호(32비트)
	* 헤더 길이(4비트) + 예약 영역(6비트) + 코드 비트(6비트) + 윈도우 크기(16비트)
	* 체크섬(16비트) + 긴급 포인터(16비트)
	* 옵션
- connection: 데이터를 전송하기 전에 SYN(연결요청), ACK(응답)을 반드시 받아야하고, 이 결과를 헤더의 코드 비트에 저장
- 재전송 제어: 데이터가 손상되거나 유실될 경우, 일정 시간 대기한 후에 일련 번호와 확인 응답 번호를 사용해 데이터를 재전송한다.

##### 윈도우크기 (16비트)
- 3-way handshake 시에 나에게 현재 얼만큼의 버퍼가 있는지 알려주는 비트
- 후에 데이터를 전송할 때, 버퍼 크기를 알기 때문에 세그먼트를 쌓을 수 있을 만큼 연속 전송한다.

##### 일련번호 (32비트)
- 송신측 -> 수신측에 알림
- 전체 데이터 중 몇번째 데이터인지 표시

##### 확인 응답 번호 (32비트)
- 송신측 <- 수신측에 알림
- 몇번째 데이터를 받았는지

##### 연결 확립: 3-way handshake
1. -> SYN: 수신 측에 연결 요청
2. <- SYN + ACK: 연결 응답 + 연결 요청
3. -> ACK: 연결 응답 (connection 확립)

##### 연결 종료
1. -> FIN: 연결 종료 요청
2. <- ACK: 응답
3. <- FIN: 연결 종료 요청
4. -> ACK: 응답 (connection 종료) 

### 포트 번호
- 0 ~ 65535 사용 가능
- 0 ~ 1023: well-known ports, 주요 프로토콜들이 사용하도록 예약

| 애플리케이션 | 포트번호 |
| -------- | ------ |
|   SSH    |   22   |
|   SMTP   |   25   |
|   DNS    |   53   |
|   HTTP   |   80   |
|   POP3   |  110   |
|   HTTPS  |  443   |

- 1024: 잘 사용하지 않음
- 1025 ~ : 송신 포트


### UDP
- 비연결형 통신 프로토콜
- 데이터를 효율적으로 빠르게 보내자!
- 스트리밍 동영상 서비스 등에 사용
- 데이터그램: [UDP 헤더][데이터]
- UDP 헤더
	* 출발지 포트 번호(16비트) + 목적지 포트 번호(16비트)
	* 길이(16비트) + 체크섬(16비트)
- 브로드캐스트 가능: 스위치를 통해 LAN 내의 모든 컴퓨터로 데이터 전송


